{% extends 'main.html' %}
{% load static %}

{% block content %}
<h3>Contacts</h3>
<div>
    <div>
        <p>You have {{contacts_count}} people in your contacts</p>
        
        <!-- Filtering by name, mail or phone number -->
        <form method="get" action="{% url 'home' %}" style="margin-bottom: 20px;">
            <input type="text" name="q" placeholder="Search..." value="{{query}}">
            <button type="submit">Search</button>
            {% if query %}
                <a href="{% url 'home' %}">Clear</a>
            {% endif %}
        </form>

    <div>
        <!-- Sorting by last name or date -->
        <label for="sort-select">Sort by:</label>
        <select id="sort-select" name="sort_by" onchange="changeSorting()">
            <option value="created" {% if active_sort == 'created' %}selected{% endif %}>Date added</option>
            <option value="last_name" {% if active_sort == 'last_name' %}selected{% endif %}>Last name</option>
        </select>
        <!-- Change sort direction -->
        {% if order == 'desc' %}
            <a href="?sort_by={{active_sort}}&order=asc{% if query %}&q={{query}}{% endif %}">↑ Ascending</a>
        {% else %}
            <a href="?sort_by={{active_sort}}&order=desc{% if query %}&q={{query}}{% endif %}">↓ Descending</a>
        {% endif %}
    </div>

    <a href="{% url 'create-contact' %}">Add new contact</a>
    {% for contact in contacts %}
        <a href="{% url 'contact' contact.id %}">
            <div class="contact-card" data-city="{{contact.city}}">
                <h4>{{contact.first_name}} {{contact.last_name}}</h4>
                <p>{{contact.phone_number}}</p>
                <p class="city">{{contact.city}}</p>

                <a href="{% url 'delete-contact' contact.id %}">Delete</a>
            </div>
        </a>
    {% endfor %}
</div>
{% endblock content %}

{% block scripts %}
<script src="{% static 'contact/js/index_sorting.js' %}"></script>
<script src="{% static 'contact/js/index_weather.js' %}"></script>
{% endblock scripts %}